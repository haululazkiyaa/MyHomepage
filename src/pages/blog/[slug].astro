---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import type { GetStaticPaths } from 'astro';

export const getStaticPaths = (async () => {
	const blogEntries = await getCollection('blog');
	return blogEntries.map(entry => ({
		params: { slug: entry.slug },
		props: { entry },
	}));
}) satisfies GetStaticPaths;

const { entry } = Astro.props;
const { Content } = await entry.render();

// Get all blogs for related posts
const allBlogs = await getCollection('blog');

// Get related posts (same category, excluding current post)
const relatedPosts = allBlogs
	.filter((b) => b.data.category === entry.data.category && b.slug !== entry.slug)
	.slice(0, 3);

const shareUrl = `${Astro.url.origin}/blog/${entry.slug}`;
---

<Layout title={`${entry.data.title} | Blog`} menu="blog">
	<!-- Floating Share Buttons -->
	<div class="hidden lg:block fixed right-4 top-1/2 -translate-y-1/2 z-40 animate-slide-in-left animate-delay-500">
		<div class="flex flex-col gap-3">
			<button 
				class="share-btn w-12 h-12 bg-[#141313] text-white flex items-center justify-center hover:scale-110 transition-transform duration-300"
				data-platform="twitter"
				title="Share on Twitter"
			>
				<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
					<path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
				</svg>
			</button>
			<button 
				class="share-btn w-12 h-12 bg-[#141313] text-white flex items-center justify-center hover:scale-110 transition-transform duration-300"
				data-platform="facebook"
				title="Share on Facebook"
			>
				<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
					<path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
				</svg>
			</button>
			<button 
				class="share-btn w-12 h-12 bg-[#141313] text-white flex items-center justify-center hover:scale-110 transition-transform duration-300"
				data-platform="linkedin"
				title="Share on LinkedIn"
			>
				<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
					<path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
				</svg>
			</button>
			<button 
				class="share-btn w-12 h-12 bg-[#141313] text-white flex items-center justify-center hover:scale-110 transition-transform duration-300"
				data-platform="copy"
				title="Copy Link"
			>
				<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
					<rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
					<path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
				</svg>
			</button>
		</div>
	</div>

	<article class="min-h-screen">
		<!-- Breadcrumb and Back Button -->
		<div class="bg-[#f3f3f3] px-4 md:px-10 lg:px-20 py-4 animate-slide-up">
			<div class="max-w-[720px] mx-auto flex items-center justify-between">
				<a 
					href="/blog" 
					class="flex items-center gap-2 text-sm font-bold hover:underline"
				>
					<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<path d="M19 12H5m7 7-7-7 7-7"/>
					</svg>
					<span class="hidden sm:inline">Back to Blog</span>
				</a>
				<nav class="flex items-center gap-2 text-sm">
					<a href="/" class="hover:underline">Home</a>
					<span>/</span>
					<a href="/blog" class="hover:underline">Blog</a>
					<span>/</span>
					<span class="text-gray-600 truncate max-w-[200px]">{entry.data.title}</span>
				</nav>
			</div>
		</div>

		<!-- Article Header -->
		<div class="pt-20 px-4 md:px-10 lg:px-20 py-10">
			<div class="max-w-[720px] mx-auto">
				<!-- Category Badge -->
				<div class="mb-4 animate-slide-up animate-delay-100">
					<span class="bg-gradient px-4 py-2 text-white text-sm font-bold rounded inline-block">
						{entry.data.category}
					</span>
				</div>

				<!-- Title -->
				<h1 class="text-3xl md:text-4xl lg:text-5xl font-bold uppercase mb-6 leading-tight animate-slide-up animate-delay-200">
					{entry.data.title}
				</h1>

				<!-- Meta Info -->
				<div class="flex flex-wrap items-center gap-4 text-sm text-gray-600 mb-8 pb-8 border-b-2 border-gray-200 animate-slide-up animate-delay-300">
					<div class="flex items-center gap-2">
						<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<circle cx="12" cy="12" r="10"></circle>
							<polyline points="12 6 12 12 16 14"></polyline>
						</svg>
						<time datetime={entry.data.publishedDate.toISOString()}>
							{entry.data.publishedDate.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}
						</time>
					</div>
					<span>•</span>
					<div class="flex items-center gap-2">
						<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<path d="M12 2v20M2 12h20"/>
						</svg>
						<span>{entry.data.readTime}</span>
					</div>
					<span>•</span>
					<div class="flex items-center gap-2">
						<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
							<circle cx="12" cy="7" r="4"></circle>
						</svg>
						<span>{entry.data.author}</span>
					</div>
				</div>

				<!-- Featured Image -->
				<div class="mb-10 animate-scale-in animate-delay-400">
					<img 
						src={entry.data.thumbnail} 
						alt={entry.data.title}
						class="w-full rounded-lg shadow-lg"
						style="aspect-ratio: 3/2;"
					/>
				</div>

				<!-- Article Content -->
				<div class="blog-content prose prose-lg max-w-none animate-slide-up animate-delay-500">
					<Content />
				</div>

				<!-- Tags -->
				<div class="mt-10 pt-8 border-t-2 border-gray-200 animate-slide-up animate-delay-100">
					<p class="text-sm font-bold mb-3">Tags:</p>
					<div class="flex flex-wrap gap-2">
						{entry.data.tags.map((tag) => (
							<span class="bg-[#f3f3f3] px-3 py-2 text-sm rounded hover:bg-[#141313] hover:text-white transition-colors cursor-pointer">
								#{tag}
							</span>
						))}
					</div>
				</div>

				<!-- Mobile Share Buttons -->
				<div class="lg:hidden mt-8 pt-8 border-t-2 border-gray-200 animate-slide-up animate-delay-200">
					<p class="text-sm font-bold mb-3">Share this article:</p>
					<div class="flex gap-3">
						<button 
							class="share-btn-mobile flex-1 bg-[#141313] text-white py-3 px-4 text-sm hover:bg-gray-800 transition-colors flex items-center justify-center gap-2"
							data-platform="twitter"
						>
							<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
								<path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
							</svg>
							Twitter
						</button>
						<button 
							class="share-btn-mobile flex-1 bg-[#141313] text-white py-3 px-4 text-sm hover:bg-gray-800 transition-colors flex items-center justify-center gap-2"
							data-platform="facebook"
						>
							<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
								<path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
							</svg>
							Facebook
						</button>
						<button 
							class="share-btn-mobile flex-1 bg-[#141313] text-white py-3 px-4 text-sm hover:bg-gray-800 transition-colors flex items-center justify-center gap-2"
							data-platform="copy"
						>
							<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
								<rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
								<path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
							</svg>
							Copy
						</button>
					</div>
				</div>
			</div>
		</div>

		<!-- Related Posts -->
		{relatedPosts.length > 0 && (
			<div class="bg-[#f3f3f3] px-4 md:px-10 lg:px-20 py-10 mt-10">
				<div class="max-w-[1200px] mx-auto">
					<h2 class="font-bold uppercase text-xl md:text-2xl mb-6 animate-slide-up">Related Articles</h2>
					<div class="grid grid-cols-1 md:grid-cols-3 gap-6">
						{relatedPosts.map((related, index) => (
							<article class={`bg-white border-2 border-[#141313] hover:shadow-lg hover:-translate-y-1 transition-all duration-300 animate-scale-in animate-delay-${index * 100}`}>
								<a href={`/blog/${related.slug}`}>
									<div class="relative overflow-hidden" style="aspect-ratio: 3/2;">
										<img 
											src={related.data.thumbnail} 
											alt={related.data.title}
											class="w-full h-full object-cover hover:scale-105 transition-transform duration-300"
										/>
									</div>
								</a>
								<div class="p-4">
									<span class="bg-gradient px-2 py-1 text-white text-xs font-bold rounded inline-block mb-2">
										{related.data.category}
									</span>
									<a href={`/blog/${related.slug}`}>
										<h3 class="font-bold text-base mb-2 hover:text-gray-600 transition-colors line-clamp-2">
											{related.data.title}
										</h3>
									</a>
									<p class="text-sm text-gray-600 line-clamp-2 mb-3">
										{related.data.excerpt}
									</p>
									<div class="flex items-center gap-2 text-xs text-gray-500">
										<time datetime={related.data.publishedDate.toISOString()}>
											{related.data.publishedDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}
										</time>
										<span>•</span>
										<span>{related.data.readTime}</span>
									</div>
								</div>
							</article>
						))}
					</div>
				</div>
			</div>
		)}
	</article>
</Layout>

<style>
	/* Blog Content Styling */
	.blog-content {
		color: #141313;
		line-height: 1.8;
	}

	.blog-content :global(h2) {
		font-size: 2rem;
		font-weight: 700;
		text-transform: uppercase;
		margin-top: 3rem;
		margin-bottom: 1.5rem;
		line-height: 1.2;
	}

	.blog-content :global(h3) {
		font-size: 1.5rem;
		font-weight: 700;
		margin-top: 2rem;
		margin-bottom: 1rem;
		line-height: 1.3;
	}

	.blog-content :global(p) {
		margin-bottom: 1.5rem;
		font-size: 1.125rem;
	}

	.blog-content :global(ul),
	.blog-content :global(ol) {
		margin-bottom: 1.5rem;
		padding-left: 2rem;
	}

	.blog-content :global(ul) {
		list-style-type: disc;
	}

	.blog-content :global(ol) {
		list-style-type: decimal;
	}

	.blog-content :global(li) {
		margin-bottom: 0.75rem;
		font-size: 1.125rem;
	}

	.blog-content :global(li strong) {
		font-weight: 700;
	}

	.blog-content :global(code) {
		background: #f3f3f3;
		padding: 0.25rem 0.5rem;
		border-radius: 0.25rem;
		font-family: 'Courier New', monospace;
		font-size: 0.9em;
	}

	.blog-content :global(pre) {
		background: #141313;
		color: #fff;
		padding: 1.5rem;
		border-radius: 0.5rem;
		overflow-x: auto;
		margin-bottom: 1.5rem;
	}

	.blog-content :global(pre code) {
		background: transparent;
		padding: 0;
		color: #fff;
		font-size: 0.9rem;
	}

	.blog-content :global(blockquote) {
		border-left: 4px solid #141313;
		padding-left: 1.5rem;
		margin: 2rem 0;
		font-style: italic;
		color: #666;
	}

	.blog-content :global(strong) {
		font-weight: 700;
	}

	.blog-content :global(a) {
		color: #141313;
		text-decoration: underline;
		transition: opacity 0.2s;
	}

	.blog-content :global(a:hover) {
		opacity: 0.7;
	}
</style>

<script define:vars={{ shareUrl, title: entry.data.title }}>
	// Share functionality
	const shareButtons = document.querySelectorAll('.share-btn, .share-btn-mobile');
	
	shareButtons.forEach(btn => {
		btn.addEventListener('click', () => {
			const platform = btn.getAttribute('data-platform');
			
			switch (platform) {
				case 'twitter':
					window.open(`https://twitter.com/intent/tweet?url=${encodeURIComponent(shareUrl)}&text=${encodeURIComponent(title)}`, '_blank');
					break;
				case 'facebook':
					window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`, '_blank');
					break;
				case 'linkedin':
					window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(shareUrl)}`, '_blank');
					break;
				case 'copy':
					navigator.clipboard.writeText(shareUrl).then(() => {
						// Show feedback
						const originalHTML = btn.innerHTML;
						btn.innerHTML = '<span>✓ Copied!</span>';
						setTimeout(() => {
							btn.innerHTML = originalHTML;
						}, 2000);
					});
					break;
			}
		});
	});
</script>
